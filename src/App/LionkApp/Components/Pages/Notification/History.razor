@page "/history"
@using Lionk.Notification

@if (notifications == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudTable Items="notifications" Hover="true" SortLabel="Trier par" Elevation="0" AllowUnsorted="false">
        <HeaderContent>
            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<NotificationHistory, object>(x => x.Notification.Timestamp)">Date</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<NotificationHistory, object>(x => x.Notification.Content.Title)">Titre</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<NotificationHistory, object>(x => x.IsRead)">Statut</MudTableSortLabel></MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Date">@context.Notification.Timestamp.ToString("g")</MudTd>
            <MudTd DataLabel="Titre">@context.Notification.Content.Title</MudTd>
            <MudTd DataLabel="Statut">@context.IsRead ? "Lu" : "Non Lu"</MudTd>
            <MudTd>
                <MudButton OnClick="@(() => MarkAsRead(@context))">Marquer comme lu</MudButton>
                <MudButton OnClick="@(() => MarkAsUnread(@context))">Marquer comme non lu</MudButton>
            </MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager PageSizeOptions="new int[]{50, 100}" />
        </PagerContent>
    </MudTable>
}

@code {
    List<NotificationHistory>? notifications;

    protected override void OnInitialized()
    {
        notifications = NotificationService.GetNotifications();
    }

    private void MarkAsRead(NotificationHistory notification)
    {
        notification.Read();
    }

    private void MarkAsUnread(NotificationHistory notification)
    {
        notification.Unread();
    }
}
