@using MudBlazor
@using System.Reflection
@namespace Lionk.Core.Dialog

<MudDialog>
    <DialogContent>
        <MudCarousel Class="mud-width-full"
                     Style="height:100%;"
                     ShowArrows="true"
                     ShowBullets="true"
                     EnableSwipeGesture="true"
                     AutoCycle="false"
                     TData="object"
                     SelectedIndexChanged="ViewChanged">
            @if (Views is not null && Views.Count > 0)
            {
                foreach (var view in Views)
                {
                    <MudCarouselItem>
                        <DynamicComponent Type="@view" Parameters="_parameter" />
                    </MudCarouselItem>
                }
            }
        </MudCarousel>
    </DialogContent>
    <DialogActions>
        <MudSpacer />
        <MudButton OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance? MudDialog { get; set; }



    [Parameter] public object? Component { get; set; }
    [Parameter] public List<Type>? Views { get; set; }
    [Parameter] public int CurrentIndex { get; set; }
    private Dictionary<string, object> _parameter = new Dictionary<string, object>();

    protected override void OnInitialized()
    {
        if (Component is null) return;
        _parameter.Add("Component", Component);
    }

    private void Submit()
    {
        if (MudDialog is null) return;
        MudDialog.Close(DialogResult.Ok(CurrentIndex));
    }

    private void ViewChanged(int index) => CurrentIndex = index;
}
