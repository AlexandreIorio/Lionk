@using Lionk.Core.View
@using MudBlazor
@using System.Reflection
@namespace Lionk.Core.Dialog

<MudDialog Style="height:50%">
    <DialogContent >
        <MudCarousel ShowArrows="true"
                     ShowBullets="false"
                     EnableSwipeGesture="true"
                     AutoCycle="false"
                     TData="object"
                     SelectedIndexChanged="ViewChanged"
                     Style="height:100%">
            @if (ViewDescription is not null && ViewDescription.Count > 0)
            {
                foreach (var viewDescription in ViewDescription)
                {
                    <MudCarouselItem Style="margin-left:50px; margin-right:50px; overflow-y: scroll;">
                    <DynamicComponent Type="@viewDescription.ViewType" Parameters="_parameter"/>
                    </MudCarouselItem>
                }
            }
        </MudCarousel>
    </DialogContent>
    <DialogActions>
        <MudSpacer />
        <MudButton OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance? MudDialog { get; set; }



    [Parameter] public object? Component { get; set; }
    [Parameter] public List<ComponentViewDescription>? ViewDescription { get; set; }
    [Parameter] public int CurrentIndex { get; set; }
    private Dictionary<string, object> _parameter = new Dictionary<string, object>();

    protected override void OnInitialized()
    {
        if (Component is null) return;
        _parameter.Add("Component", Component);
    }

    private void Submit()
    {
        if (MudDialog is null) return;
        MudDialog.Close(DialogResult.Ok(CurrentIndex));
    }

    private void ViewChanged(int index) => CurrentIndex = index;
}
