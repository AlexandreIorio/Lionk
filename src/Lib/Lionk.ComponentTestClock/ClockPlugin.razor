@using Lionk.Core
@using Lionk.Core.Component
@using Lionk.Core.Razor
@using MudBlazor
@inject ISnackbar Snackbar
@implements ICyclicComponent

@attribute [NamedElement("Clock", "a sweet clock widget")]
<MudCard>
    <MudCardContent>
        <MudText Typo="Typo.h3">@InstanceName</MudText>
        <MudText Typo="Typo.h4">@currentTime</MudText>
    </MudCardContent>
</MudCard>

@code {
    private string currentTime = "No time setted";

    public string? InstanceName { get; set; }
    public TimeSpan ExecutionFrequency => TimeSpan.FromSeconds(1);
    public DateTime LastExecution { get; }
    public int NbCycle { get; set; }
    public DateTime StartedDate { get; set; }

    public TimeSpan? Execute()
    {
        DateTime start = DateTime.UtcNow;
        Snackbar.Add($"Time updated", Severity.Success);
        return DateTime.UtcNow - start;
    }

    protected override void OnInitialized()
    {
        InstanceName = "Super Clock";
        currentTime = DateTime.Now.ToString("HH:mm:ss");
        var timer = new System.Timers.Timer(1000);
        timer.Elapsed += (sender, e) => InvokeAsync(UpdateTime);
        timer.Start();
    }

    private void UpdateTime()
    {
        currentTime = DateTime.Now.ToString("HH:mm:ss");
        StateHasChanged();
    }

}
